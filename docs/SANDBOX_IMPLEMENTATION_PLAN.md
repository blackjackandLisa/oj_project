# ğŸ›¡ï¸ å®‰å…¨æ²™ç®±æ¸è¿›å¼å®æ–½è®¡åˆ’

## ğŸ“‹ æ€»ä½“è§„åˆ’

æˆ‘ä»¬å°†åˆ†3ä¸ªé˜¶æ®µé€æ­¥å®æ–½å®Œæ•´çš„å®‰å…¨æ²™ç®±ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œåç»­é˜¶æ®µåœ¨å‰ä¸€é˜¶æ®µåŸºç¡€ä¸Šå¢å¼ºã€‚

### é˜¶æ®µæ¦‚è§ˆ

| é˜¶æ®µ | æ–¹æ¡ˆ | å®‰å…¨ç­‰çº§ | é¢„è®¡æ—¶é—´ | çŠ¶æ€ |
|-----|------|---------|---------|------|
| **é˜¶æ®µ1** | å¿«é€ŸåŠ å›º + åŸºç¡€é™åˆ¶ | ğŸŸ¡ ä¸­ä½ | 30åˆ†é’Ÿ | ğŸ”„ è¿›è¡Œä¸­ |
| **é˜¶æ®µ2** | Dockerå®¹å™¨éš”ç¦» | ğŸŸ¡ ä¸­ | 1-2å¤© | â³ å¾…å¼€å§‹ |
| **é˜¶æ®µ3** | Judger0ä¸“ä¸šæ²™ç®± | ğŸŸ¢ é«˜ | 1å‘¨ | â³ å¾…å¼€å§‹ |

---

## ğŸ¯ é˜¶æ®µ1ï¼šå¿«é€ŸåŠ å›º + åŸºç¡€é™åˆ¶

**ç›®æ ‡**ï¼šç«‹å³æå‡åŸºç¡€å®‰å…¨æ€§ï¼Œä½œä¸ºä¸´æ—¶ä¿æŠ¤æªæ–½

**æ—¶é—´**ï¼š30åˆ†é’Ÿ

### 1.1 åº”ç”¨å®‰å…¨åŠ å›ºä»£ç 

**ä»»åŠ¡æ¸…å•**ï¼š
- [x] åˆ›å»ºå®‰å…¨åŠ å›ºç‰ˆä»£ç ï¼ˆtasks_secure.pyï¼‰
- [ ] å¤‡ä»½ç°æœ‰åˆ¤é¢˜ä»£ç 
- [ ] åº”ç”¨å®‰å…¨åŠ å›ºç‰ˆ
- [ ] é‡å¯CeleryæœåŠ¡
- [ ] æµ‹è¯•åˆ¤é¢˜åŠŸèƒ½

### 1.2 æ·»åŠ æ•°æ®åº“å®¡è®¡æ—¥å¿—

**ç›®æ ‡**ï¼šè®°å½•æ‰€æœ‰æäº¤ï¼Œä¾¿äºå®‰å…¨å®¡è®¡

### 1.3 æ·»åŠ å®æ—¶ç›‘æ§

**ç›®æ ‡**ï¼šç›‘æ§èµ„æºä½¿ç”¨ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸

### 1.4 é…ç½®è®¿é—®é™åˆ¶

**ç›®æ ‡**ï¼šé™åˆ¶ç³»ç»Ÿè®¿é—®ï¼Œé™ä½é£é™©é¢

---

## ğŸ³ é˜¶æ®µ2ï¼šDockerå®¹å™¨éš”ç¦»

**ç›®æ ‡**ï¼šä¸ºæ¯æ¬¡åˆ¤é¢˜åˆ›å»ºç‹¬ç«‹çš„ä¸´æ—¶å®¹å™¨ï¼Œå®ç°å¼ºéš”ç¦»

**æ—¶é—´**ï¼š1-2å¤©

### 2.1 å‡†å¤‡å·¥ä½œ

- [ ] å®‰è£…Docker Python SDK
- [ ] å‡†å¤‡åˆ¤é¢˜é•œåƒï¼ˆPythonã€C++ï¼‰
- [ ] é…ç½®Dockerå®ˆæŠ¤è¿›ç¨‹
- [ ] è®¾è®¡å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†

### 2.2 å®ç°Dockeråˆ¤é¢˜å¼•æ“

- [ ] åˆ›å»ºDockeråˆ¤é¢˜å®¢æˆ·ç«¯
- [ ] å®ç°Pythonå®¹å™¨åˆ¤é¢˜
- [ ] å®ç°C++å®¹å™¨åˆ¤é¢˜
- [ ] æ·»åŠ å®¹å™¨èµ„æºé™åˆ¶
- [ ] å®ç°å®¹å™¨æ¸…ç†æœºåˆ¶

### 2.3 æ€§èƒ½ä¼˜åŒ–

- [ ] å®¹å™¨é•œåƒç¼“å­˜
- [ ] å®¹å™¨å¤ç”¨ç­–ç•¥
- [ ] å¹¶å‘æ§åˆ¶
- [ ] è¶…æ—¶å¤„ç†

### 2.4 æµ‹è¯•éªŒè¯

- [ ] åŠŸèƒ½æµ‹è¯•
- [ ] å®‰å…¨æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] å‹åŠ›æµ‹è¯•

---

## ğŸ† é˜¶æ®µ3ï¼šJudger0ä¸“ä¸šæ²™ç®±

**ç›®æ ‡**ï¼šé›†æˆæˆç†Ÿçš„Judger0æ²™ç®±ï¼Œè¾¾åˆ°ç”Ÿäº§çº§å®‰å…¨æ°´å¹³

**æ—¶é—´**ï¼š1å‘¨

### 3.1 éƒ¨ç½²Judger0

- [ ] é…ç½®docker-compose
- [ ] éƒ¨ç½²Judger0æœåŠ¡
- [ ] é…ç½®æ•°æ®åº“
- [ ] éªŒè¯æœåŠ¡å¯ç”¨æ€§

### 3.2 é›†æˆJudger0 API

- [ ] åˆ›å»ºJudger0å®¢æˆ·ç«¯
- [ ] å®ç°æäº¤æ¥å£
- [ ] å®ç°ç»“æœæŸ¥è¯¢
- [ ] é”™è¯¯å¤„ç†

### 3.3 è¿ç§»ç°æœ‰ç³»ç»Ÿ

- [ ] é€‚é…è¯­è¨€IDæ˜ å°„
- [ ] é€‚é…æµ‹è¯•ç”¨ä¾‹æ ¼å¼
- [ ] è¿ç§»å†å²æ•°æ®
- [ ] æ›´æ–°å‰ç«¯äº¤äº’

### 3.4 ç›‘æ§å’Œç»´æŠ¤

- [ ] å¥åº·æ£€æŸ¥
- [ ] æ€§èƒ½ç›‘æ§
- [ ] æ—¥å¿—æ”¶é›†
- [ ] å‘Šè­¦é…ç½®

---

## ğŸ“… è¯¦ç»†å®æ–½æ­¥éª¤

## é˜¶æ®µ1è¯¦ç»†æ­¥éª¤ï¼ˆä»Šå¤©å®Œæˆï¼‰

### æ­¥éª¤1.1ï¼šåº”ç”¨å®‰å…¨åŠ å›ºç‰ˆæœ¬ â±ï¸ 5åˆ†é’Ÿ

```bash
# 1. å¤‡ä»½åŸæ–‡ä»¶
docker-compose exec web cp oj_project/judge/tasks.py oj_project/judge/tasks_backup.py

# 2. åº”ç”¨å®‰å…¨ç‰ˆæœ¬
docker-compose exec web cp oj_project/judge/tasks_secure.py oj_project/judge/tasks.py

# 3. é‡å¯Celery
docker-compose restart celery celery-beat

# 4. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤å¯åŠ¨
docker-compose logs celery | tail -20
```

### æ­¥éª¤1.2ï¼šæ·»åŠ æäº¤å®¡è®¡æ—¥å¿— â±ï¸ 10åˆ†é’Ÿ

åˆ›å»º `oj_project/judge/audit.py`ï¼š

```python
import logging
from datetime import datetime

logger = logging.getLogger('judge.audit')

def log_submission(submission, event, details=None):
    """è®°å½•æäº¤å®¡è®¡æ—¥å¿—"""
    log_data = {
        'timestamp': datetime.now().isoformat(),
        'submission_id': submission.id,
        'user_id': submission.user.id,
        'username': submission.user.username,
        'problem_id': submission.problem.id,
        'language': submission.language,
        'status': submission.status,
        'event': event,
        'details': details or {}
    }
    logger.info(f"AUDIT: {log_data}")
```

### æ­¥éª¤1.3ï¼šæ·»åŠ ç›‘æ§ç«¯ç‚¹ â±ï¸ 10åˆ†é’Ÿ

åˆ›å»ºå¥åº·æ£€æŸ¥å’Œç›‘æ§è§†å›¾

### æ­¥éª¤1.4ï¼šé…ç½®è®¿é—®æ§åˆ¶ â±ï¸ 5åˆ†é’Ÿ

- é™åˆ¶æ³¨å†Œï¼ˆéœ€è¦é‚€è¯·ç ï¼‰
- æ·»åŠ éªŒè¯ç 
- é™æµï¼ˆrate limitingï¼‰

---

## é˜¶æ®µ2è¯¦ç»†æ­¥éª¤ï¼ˆæ˜å¤©-åå¤©ï¼‰

### æ­¥éª¤2.1ï¼šå®‰è£…ä¾èµ– â±ï¸ 5åˆ†é’Ÿ

```bash
# æ·»åŠ åˆ°requirements.txt
docker==6.1.3

# å®‰è£…
docker-compose exec web pip install docker==6.1.3
```

### æ­¥éª¤2.2ï¼šåˆ›å»ºDockeråˆ¤é¢˜å¼•æ“ â±ï¸ 4å°æ—¶

è¯¦ç»†ä»£ç è§åç»­ç« èŠ‚

### æ­¥éª¤2.3ï¼šæµ‹è¯•å’Œä¼˜åŒ– â±ï¸ 3å°æ—¶

### æ­¥éª¤2.4ï¼šæ–‡æ¡£å’Œéƒ¨ç½² â±ï¸ 1å°æ—¶

---

## é˜¶æ®µ3è¯¦ç»†æ­¥éª¤ï¼ˆä¸‹å‘¨ï¼‰

### æ­¥éª¤3.1ï¼šéƒ¨ç½²Judger0 â±ï¸ 2å°æ—¶

```yaml
# docker-compose.yml æ·»åŠ 
judger0-server:
  image: judge0/judge0:1.13.0
  volumes:
    - ./judger0.conf:/judge0.conf:ro
  privileged: true
  <<: *logging
  restart: always

judger0-workers:
  image: judge0/judge0:1.13.0
  command: ["./scripts/workers"]
  privileged: true
  restart: always
```

### æ­¥éª¤3.2-3.4ï¼šé›†æˆå’Œä¼˜åŒ– â±ï¸ 1-2å¤©

---

## ğŸ¯ ç«‹å³å¼€å§‹é˜¶æ®µ1

è®©æˆ‘ä»¬ç°åœ¨å¼€å§‹æ‰§è¡Œé˜¶æ®µ1çš„ç¬¬ä¸€æ­¥ï¼

å‡†å¤‡å¥½äº†å—ï¼Ÿæˆ‘å°†ï¼š
1. âœ… å¤‡ä»½ç°æœ‰ä»£ç 
2. âœ… åº”ç”¨å®‰å…¨åŠ å›ºç‰ˆ
3. âœ… é‡å¯æœåŠ¡
4. âœ… æµ‹è¯•éªŒè¯
5. âœ… æ·»åŠ å®¡è®¡æ—¥å¿—
6. âœ… æ·»åŠ ç›‘æ§ç«¯ç‚¹

---

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**ï¼š
- ç«‹å³æ‰§è¡Œé˜¶æ®µ1ï¼ˆ30åˆ†é’Ÿå†…å®Œæˆï¼‰
- ä»Šå¤©å®ŒæˆåŸºç¡€å®‰å…¨åŠ å›º
- æ˜å¤©å¼€å§‹Dockerå®¹å™¨éš”ç¦»
- ä¸‹å‘¨é›†æˆJudger0

**å½“å‰ä¼˜å…ˆçº§**ï¼šğŸ”´ é«˜ - ç«‹å³æ‰§è¡Œ
**é¢„æœŸå®Œæˆæ—¶é—´**ï¼šä»Šå¤©

